{"ast":null,"code":"const S3 = require('aws-sdk/clients/s3');\n\nconst formidable = require('formidable');\n\nconst multer = require('multer');\n\nconst upload = multer();\nconst s3 = new S3({\n  apiVersion: '2006-03-01'\n});\nexport const config = {\n  api: {\n    externalResolver: true\n  }\n};\n\nfunction runMiddleware(req, res, fn) {\n  return new Promise((resolve, reject) => {\n    fn(req, res, result => {\n      if (result instanceof Error) {\n        return reject(result);\n      }\n\n      return resolve(result);\n    });\n  });\n}\n\nexport default async function handler(req, res) {\n  if (req.method === 'POST') {\n    const result = await runMiddleware(req, res, upload.single('soundBlob'));\n    console.log('result', result); // const result = await upload(req, res);\n    // console.log('result', result);\n    // const form = new formidable({ multiples: true });\n    // console.log('hello before form.parse');\n    // console.log('req.body', JSON.stringify(req.body));\n    // console.log('req', req);\n\n    res.end(); // return;\n    // await s3.upload(\n    //   {\n    //     Bucket: process.env.AWS_BUCKET,\n    //     Key: req.file.originalname,\n    //     Body: Buffer.from(new Uint8Array(req.file.buffer)),\n    //   },\n    //   async (err, data) => {\n    //     if (err) {\n    //       console.log('error: ', err);\n    //       res.sendStatus(404);\n    //     }\n    //     res.send(\n    //       `https://${process.env.AWS_BUCKET}/${escape(req.file.originalname)}`\n    //     );\n    //   }\n    // );\n    // console.log('req', req.body);\n  }\n}","map":{"version":3,"sources":["/Users/mfjvacas/Documents/Dev/GitHub/projects/mapstereo-client/pages/api/upload.ts"],"names":["S3","require","formidable","multer","upload","s3","apiVersion","config","api","externalResolver","runMiddleware","req","res","fn","Promise","resolve","reject","result","Error","handler","method","single","console","log","end"],"mappings":"AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAC,oBAAD,CAAlB;;AACA,MAAMC,UAAU,GAAGD,OAAO,CAAC,YAAD,CAA1B;;AACA,MAAME,MAAM,GAAGF,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAMG,MAAM,GAAGD,MAAM,EAArB;AAEA,MAAME,EAAE,GAAG,IAAIL,EAAJ,CAAO;AAAEM,EAAAA,UAAU,EAAE;AAAd,CAAP,CAAX;AAEA,OAAO,MAAMC,MAAM,GAAG;AACpBC,EAAAA,GAAG,EAAE;AACHC,IAAAA,gBAAgB,EAAE;AADf;AADe,CAAf;;AAMP,SAASC,aAAT,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiCC,EAAjC,EAAqC;AACnC,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCH,IAAAA,EAAE,CAACF,GAAD,EAAMC,GAAN,EAAYK,MAAD,IAAY;AACvB,UAAIA,MAAM,YAAYC,KAAtB,EAA6B;AAC3B,eAAOF,MAAM,CAACC,MAAD,CAAb;AACD;;AAED,aAAOF,OAAO,CAACE,MAAD,CAAd;AACD,KANC,CAAF;AAOD,GARM,CAAP;AASD;;AAED,eAAe,eAAeE,OAAf,CAAuBR,GAAvB,EAA4BC,GAA5B,EAAiC;AAC9C,MAAID,GAAG,CAACS,MAAJ,KAAe,MAAnB,EAA2B;AACzB,UAAMH,MAAM,GAAG,MAAMP,aAAa,CAACC,GAAD,EAAMC,GAAN,EAAWR,MAAM,CAACiB,MAAP,CAAc,WAAd,CAAX,CAAlC;AAEAC,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBN,MAAtB,EAHyB,CAKzB;AACA;AAEA;AAEA;AAEA;AACA;;AAEAL,IAAAA,GAAG,CAACY,GAAJ,GAfyB,CAgBzB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEE;AACH;AACF","sourcesContent":["const S3 = require('aws-sdk/clients/s3');\nconst formidable = require('formidable');\nconst multer = require('multer');\nconst upload = multer();\n\nconst s3 = new S3({ apiVersion: '2006-03-01' });\n\nexport const config = {\n  api: {\n    externalResolver: true,\n  }\n}\n\nfunction runMiddleware(req, res, fn) {\n  return new Promise((resolve, reject) => {\n    fn(req, res, (result) => {\n      if (result instanceof Error) {\n        return reject(result)\n      }\n\n      return resolve(result)\n    })\n  })\n}\n\nexport default async function handler(req, res) {\n  if (req.method === 'POST') {\n    const result = await runMiddleware(req, res, upload.single('soundBlob'));\n\n    console.log('result', result);\n    \n    // const result = await upload(req, res);\n    // console.log('result', result);\n    \n    // const form = new formidable({ multiples: true });\n\n    // console.log('hello before form.parse');\n\n    // console.log('req.body', JSON.stringify(req.body));\n    // console.log('req', req);\n\n    res.end();\n    // return;\n\n    // await s3.upload(\n    //   {\n    //     Bucket: process.env.AWS_BUCKET,\n    //     Key: req.file.originalname,\n    //     Body: Buffer.from(new Uint8Array(req.file.buffer)),\n    //   },\n    //   async (err, data) => {\n    //     if (err) {\n    //       console.log('error: ', err);\n    //       res.sendStatus(404);\n    //     }\n\n    //     res.send(\n    //       `https://${process.env.AWS_BUCKET}/${escape(req.file.originalname)}`\n    //     );\n    //   }\n    // );\n\n      // console.log('req', req.body);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}