{"ast":null,"code":"const S3 = require('aws-sdk/clients/s3');\n\nconst multer = require('multer');\n\nconst upload = multer();\nconst s3 = new S3({\n  apiVersion: '2006-03-01'\n}); // export const config = {\n//   api: {\n//     bodyParser: false,\n//   }\n// }\n\nfunction runMiddleware(req, res, fn) {\n  return new Promise((resolve, reject) => {\n    fn(req, res, result => {\n      if (result instanceof Error) {\n        return reject(result);\n      }\n\n      return resolve(result);\n    });\n  });\n}\n\nexport default (async (req, res) => {\n  if (req.method === 'POST') {\n    const uploadFile = (request, response) => {\n      console.log('before upload');\n      upload.single(\"soundBlob\")(async (req, {}, err) => {\n        console.log('inside upload');\n\n        try {\n          console.log('req', req);\n          await s3.upload({\n            Bucket: process.env.AWS_BUCKET,\n            Key: req.file.originalname,\n            Body: Buffer.from(new Uint8Array(req.file.buffer))\n          }, async (err, data) => {\n            if (err) {\n              console.log('error: ', err);\n              res.sendStatus(404);\n            }\n\n            res.send(`https://${process.env.AWS_BUCKET}/${escape(req.file.originalname)}`);\n          });\n        } catch (err) {\n          console.log(err);\n        }\n      });\n    };\n\n    return uploadFile(req, res);\n    res.end();\n  }\n});","map":{"version":3,"sources":["/Users/mfjvacas/Documents/Dev/GitHub/projects/mapstereo-client/pages/api/upload.ts"],"names":["S3","require","multer","upload","s3","apiVersion","runMiddleware","req","res","fn","Promise","resolve","reject","result","Error","method","uploadFile","request","response","console","log","single","err","Bucket","process","env","AWS_BUCKET","Key","file","originalname","Body","Buffer","from","Uint8Array","buffer","data","sendStatus","send","escape","end"],"mappings":"AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAC,oBAAD,CAAlB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAME,MAAM,GAAGD,MAAM,EAArB;AAEA,MAAME,EAAE,GAAG,IAAIJ,EAAJ,CAAO;AAAEK,EAAAA,UAAU,EAAE;AAAd,CAAP,CAAX,C,CAEA;AACA;AACA;AACA;AACA;;AAEA,SAASC,aAAT,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiCC,EAAjC,EAAqC;AACnC,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCH,IAAAA,EAAE,CAACF,GAAD,EAAMC,GAAN,EAAYK,MAAD,IAAY;AACvB,UAAIA,MAAM,YAAYC,KAAtB,EAA6B;AAC3B,eAAOF,MAAM,CAACC,MAAD,CAAb;AACD;;AAED,aAAOF,OAAO,CAACE,MAAD,CAAd;AACD,KANC,CAAF;AAOD,GARM,CAAP;AASD;;AAED,gBAAe,OAAON,GAAP,EAAYC,GAAZ,KAAoB;AACjC,MAAID,GAAG,CAACQ,MAAJ,KAAe,MAAnB,EAA2B;AACzB,UAAMC,UAAU,GAAG,CAACC,OAAD,EAAUC,QAAV,KAAuB;AACxCC,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AAEAjB,MAAAA,MAAM,CAACkB,MAAP,CAAc,WAAd,EAA2B,OAAOd,GAAP,EAAY,EAAZ,EAAgBe,GAAhB,KAAwB;AACjDH,QAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;;AACA,YAAI;AAEFD,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBb,GAAnB;AAGA,gBAAMH,EAAE,CAACD,MAAH,CACJ;AACEoB,YAAAA,MAAM,EAAEC,OAAO,CAACC,GAAR,CAAYC,UADtB;AAEEC,YAAAA,GAAG,EAAEpB,GAAG,CAACqB,IAAJ,CAASC,YAFhB;AAGEC,YAAAA,IAAI,EAAEC,MAAM,CAACC,IAAP,CAAY,IAAIC,UAAJ,CAAe1B,GAAG,CAACqB,IAAJ,CAASM,MAAxB,CAAZ;AAHR,WADI,EAMJ,OAAOZ,GAAP,EAAYa,IAAZ,KAAqB;AACnB,gBAAIb,GAAJ,EAAS;AACPH,cAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBE,GAAvB;AACAd,cAAAA,GAAG,CAAC4B,UAAJ,CAAe,GAAf;AACD;;AAED5B,YAAAA,GAAG,CAAC6B,IAAJ,CACG,WAAUb,OAAO,CAACC,GAAR,CAAYC,UAAW,IAAGY,MAAM,CAAC/B,GAAG,CAACqB,IAAJ,CAASC,YAAV,CAAwB,EADrE;AAGD,WAfG,CAAN;AAkBD,SAvBD,CAuBE,OAAOP,GAAP,EAAY;AACZH,UAAAA,OAAO,CAACC,GAAR,CAAYE,GAAZ;AACD;AACF,OA5BD;AA6BD,KAhCD;;AAkCA,WAAON,UAAU,CAACT,GAAD,EAAMC,GAAN,CAAjB;AAGAA,IAAAA,GAAG,CAAC+B,GAAJ;AACD;AACF,CAzCD","sourcesContent":["const S3 = require('aws-sdk/clients/s3');\nconst multer = require('multer');\nconst upload = multer();\n\nconst s3 = new S3({ apiVersion: '2006-03-01' });\n\n// export const config = {\n//   api: {\n//     bodyParser: false,\n//   }\n// }\n\nfunction runMiddleware(req, res, fn) {\n  return new Promise((resolve, reject) => {\n    fn(req, res, (result) => {\n      if (result instanceof Error) {\n        return reject(result)\n      }\n\n      return resolve(result)\n    })\n  })\n}\n\nexport default async (req, res) => {\n  if (req.method === 'POST') {\n    const uploadFile = (request, response) => {\n      console.log('before upload');\n      \n      upload.single(\"soundBlob\")(async (req, {}, err) => {\n        console.log('inside upload');\n        try {\n\n          console.log('req', req);\n          \n  \n          await s3.upload(\n            {\n              Bucket: process.env.AWS_BUCKET,\n              Key: req.file.originalname,\n              Body: Buffer.from(new Uint8Array(req.file.buffer)),\n            },\n            async (err, data) => {\n              if (err) {\n                console.log('error: ', err);\n                res.sendStatus(404);\n              }\n  \n              res.send(\n                `https://${process.env.AWS_BUCKET}/${escape(req.file.originalname)}`\n              );\n            }\n          );\n\n        } catch (err) {\n          console.log(err);\n        }\n      });\n    }\n\n    return uploadFile(req, res);\n\n        \n    res.end();\n  }\n}\n"]},"metadata":{},"sourceType":"module"}