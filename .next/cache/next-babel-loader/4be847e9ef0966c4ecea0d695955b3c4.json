{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\n\nvar _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  & .cardWrapper {\\n    width: 400px;\\n    z-index: 3;\\n    margin: 10px 0;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React from 'react';\nimport { useDrop } from 'react-dnd';\nimport styled from 'styled-components';\nimport ListItem from './ListItem';\nimport { ItemTypes } from './ItemTypes';\nimport maxBy from 'lodash/maxBy';\nimport { getRecorderId } from './helper';\nimport update from 'immutability-helper';\nimport Recorder from './Recorder';\nimport Box from './Box';\nvar StyledList = styled.div(_templateObject());\n_c = StyledList;\n\nvar getCurrentIndex = function getCurrentIndex(currentId, listItems, listId) {\n  var currentIndex = listItems.findIndex(function (item) {\n    return item && getRecorderId(listId, item.id, item.blobUrl) === currentId;\n  });\n  return currentIndex;\n};\n\nvar List = function List(_ref) {\n  _s();\n\n  var updateBoxes = _ref.updateBoxes,\n      boxes = _ref.boxes,\n      fullDisable = _ref.fullDisable,\n      setDisableAll = _ref.setDisableAll,\n      playingList = _ref.playingList,\n      setPlayList = _ref.setPlayList,\n      listItems = _ref.listItems,\n      left = _ref.left,\n      top = _ref.top,\n      id = _ref.id,\n      onStop = _ref.onStop,\n      deleteBox = _ref.deleteBox,\n      socket = _ref.socket;\n\n  // if a box is dropped inside a list, box becomes into a list item and gets removed from droppable_background\n  var _useDrop = useDrop({\n    accept: [ItemTypes.CARD],\n    drop: function drop(item) {\n      if (item.type === 'card' && !item.isListItem) {\n        var listIndex = boxes.findIndex(function (box) {\n          return box.id === id;\n        });\n\n        if (!boxes[listIndex].cards.includes(item.id)) {\n          var cardIndex = boxes.findIndex(function (box) {\n            return box.id === item.id;\n          });\n          var newBoxes;\n          newBoxes = update(boxes, _defineProperty({}, listIndex, {\n            cards: {\n              $push: [item.id]\n            }\n          }));\n          newBoxes = update(newBoxes, _defineProperty({}, cardIndex, {\n            $apply: function $apply(box) {\n              return _objectSpread(_objectSpread({}, box), {}, {\n                isListItem: true\n              });\n            }\n          }));\n          updateBoxes(newBoxes);\n        }\n\n        setDisableAll(false);\n        return {\n          type: 'list'\n        };\n      }\n\n      return undefined;\n    }\n  }),\n      _useDrop2 = _slicedToArray(_useDrop, 2),\n      drop = _useDrop2[1]; // adds new list item\n\n\n  var addItem = function addItem() {\n    var listIndex = boxes.findIndex(function (box) {\n      return box.id === id;\n    });\n    var highestID = maxBy(boxes, 'id');\n    var newId = highestID.id + 1;\n    var newBoxes = update(boxes, {\n      $push: [{\n        id: newId,\n        type: 'card',\n        isListItem: true,\n        top: top,\n        left: left,\n        title: \"box #\".concat(newId),\n        blobUrl: undefined\n      }]\n    });\n    newBoxes = update(newBoxes, _defineProperty({}, listIndex, {\n      cards: {\n        $push: [newId]\n      }\n    }));\n    updateBoxes(newBoxes);\n  };\n\n  var moveCard = function moveCard(dragIndex, hoverIndex, cardId) {\n    var listIndex = boxes.findIndex(function (box) {\n      if (box.type === 'list' && box.cards.includes(cardId)) {\n        return true;\n      }\n\n      return false;\n    });\n    var newBoxes = update(boxes, _defineProperty({}, listIndex, {\n      cards: {\n        $splice: [[dragIndex, 1], [hoverIndex, 0, cardId]]\n      }\n    }));\n    updateBoxes(newBoxes);\n  }; // event listener: handles playing next clip if available\n\n\n  var playNextClip = function playNextClip(e) {\n    var currentId = e.currentTarget.id; // finds the current index in listItems\n\n    var currentIndex = getCurrentIndex(currentId, listItems, id);\n    var nextIndex = currentIndex + 1;\n    var nextAudio = listItems[nextIndex]; // if currentIndex exists and the next item exists as well, play the next track\n\n    if (currentIndex !== -1 && nextAudio && nextAudio.blobUrl) {\n      return playList(currentIndex + 1);\n    }\n\n    return setPlayList(false);\n  }; // event listener: if any item in list is paused, pause the whole list\n\n\n  var pauseList = function pauseList(e) {\n    if (e.currentTarget.paused && e.currentTarget.duration !== e.currentTarget.currentTime) {\n      setPlayList(false);\n      e.currentTarget.removeEventListener('ended', playNextClip, {\n        once: true\n      });\n      return;\n    }\n  }; // plays items in list\n\n\n  var playList = function playList(n) {\n    var listId = id;\n    var listItem = listItems[n];\n\n    if (listItem) {\n      var _id = listItem.id,\n          blobUrl = listItem.blobUrl;\n      var audioTag = document.getElementById(getRecorderId(listId, _id, blobUrl));\n      audioTag.currentTime = 0;\n      audioTag.addEventListener('ended', playNextClip, {\n        once: true\n      });\n      audioTag.addEventListener('pause', pauseList, {\n        once: true\n      });\n      audioTag.play();\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(StyledList, {\n    ref: drop\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    disabled: playingList || fullDisable,\n    onClick: addItem\n  }, \"Add list item\"), /*#__PURE__*/React.createElement(\"button\", {\n    disabled: fullDisable,\n    onClick: function onClick() {\n      setPlayList(true);\n      playList(0);\n    }\n  }, playingList ? 'Stop' : 'Play', \" list\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cardWrapper\"\n  }, listItems.length === 0 ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dropzone\"\n  }, \"Drop box here\") : listItems.map(function (listItem, i) {\n    return /*#__PURE__*/React.createElement(ListItem, {\n      key: \"listKey:\".concat(Math.pow(new Date().getDate(), i)),\n      boxes: boxes,\n      left: left,\n      top: top,\n      listItemIndex: i,\n      id: listItem.id,\n      title: listItem.title,\n      blobUrl: listItem.blobUrl,\n      moveCard: moveCard,\n      updateBoxes: updateBoxes,\n      isListItem: listItem.isListItem\n    }, /*#__PURE__*/React.createElement(Box, {\n      box: listItem,\n      deleteBox: deleteBox,\n      fullDisable: fullDisable,\n      boxes: boxes,\n      updateBoxes: updateBoxes\n    }, /*#__PURE__*/React.createElement(Recorder, {\n      playList: playingList,\n      listId: id,\n      cardId: listItem.id,\n      onStop: onStop,\n      blobUrl: listItem.blobUrl,\n      setDisableAll: setDisableAll,\n      fullDisable: fullDisable,\n      socket: socket,\n      title: listItem.title\n    })));\n  })));\n};\n\n_s(List, \"hdmCamxlwL9WeSdzgzIVyaE48AI=\", false, function () {\n  return [useDrop];\n});\n\n_c2 = List;\nexport default List;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"StyledList\");\n$RefreshReg$(_c2, \"List\");","map":{"version":3,"sources":["/Users/mfjvacas/Documents/Dev/GitHub/projects/mapstereo-client/components/List.tsx"],"names":["React","useDrop","styled","ListItem","ItemTypes","maxBy","getRecorderId","update","Recorder","Box","StyledList","div","getCurrentIndex","currentId","listItems","listId","currentIndex","findIndex","item","id","blobUrl","List","updateBoxes","boxes","fullDisable","setDisableAll","playingList","setPlayList","left","top","onStop","deleteBox","socket","accept","CARD","drop","type","isListItem","listIndex","box","cards","includes","cardIndex","newBoxes","$push","$apply","undefined","addItem","highestID","newId","title","moveCard","dragIndex","hoverIndex","cardId","$splice","playNextClip","e","currentTarget","nextIndex","nextAudio","playList","pauseList","paused","duration","currentTime","removeEventListener","once","n","listItem","audioTag","document","getElementById","addEventListener","play","length","map","i","Math","pow","Date","getDate"],"mappings":"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","sourcesContent":["import React, { Dispatch, SetStateAction } from 'react';\nimport { useDrop } from 'react-dnd';\nimport styled from 'styled-components';\nimport ListItem from './ListItem';\nimport { ItemTypes } from './ItemTypes';\nimport maxBy from 'lodash/maxBy';\nimport { getRecorderId } from './helper';\nimport BoxType from './types/box';\nimport update from 'immutability-helper';\nimport Recorder from './Recorder';\nimport Box from './Box';\n\nexport interface Props {\n  drop?: any;\n  deleteBox?: Function;\n  updateBoxes?: (boxes: Array<BoxType>) => void;\n  boxes?: Array<BoxType>;\n  setDisableAll?: Dispatch<SetStateAction<boolean>>;\n  fullDisable?: boolean;\n  playingList?: boolean;\n  setPlayList?: Dispatch<SetStateAction<boolean>>;\n  listItems?: Array<BoxType>;\n  left?: number;\n  top?: number;\n  id?: number;\n  onStop: (url: string, cardId: number) => void;\n  socket?: SocketIOClient.Socket;\n}\n\nconst StyledList = styled.div`\n  & .cardWrapper {\n    width: 400px;\n    z-index: 3;\n    margin: 10px 0;\n  }\n`;\n\nconst getCurrentIndex = (currentId, listItems, listId) => {\n  const currentIndex = listItems.findIndex(\n    (item) =>\n      item && getRecorderId(listId, item.id, item.blobUrl) === currentId\n  );\n\n  return currentIndex;\n};\n\nconst List = ({\n  updateBoxes,\n  boxes,\n  fullDisable,\n  setDisableAll,\n  playingList,\n  setPlayList,\n  listItems,\n  left,\n  top,\n  id,\n  onStop,\n  deleteBox,\n  socket,\n}: Props) => {\n  // if a box is dropped inside a list, box becomes into a list item and gets removed from droppable_background\n  const [, drop] = useDrop({\n    accept: [ItemTypes.CARD],\n    drop: (item: any) => {\n\n      if (item.type === 'card' && !item.isListItem) {\n        const listIndex = boxes.findIndex((box) => box.id === id);\n\n        if (!boxes[listIndex].cards.includes(item.id)) {\n          const cardIndex = boxes.findIndex((box) => box.id === item.id);\n          let newBoxes;\n          newBoxes = update(boxes, {\n            [listIndex]: {\n              cards: {\n                $push: [item.id],\n              },\n            },\n          });\n\n          newBoxes = update(newBoxes, {\n            [cardIndex]: {\n              $apply: (box) => ({\n                ...box,\n                isListItem: true,\n              }),\n            },\n          });\n\n          updateBoxes(newBoxes);\n        }\n\n        setDisableAll(false);\n\n        return { type: 'list' };\n      }\n\n      return undefined;\n    },\n  });\n\n  // adds new list item\n  const addItem = () => {\n    const listIndex = boxes.findIndex((box) => box.id === id);\n    const highestID = maxBy(boxes, 'id');\n    const newId = highestID.id + 1;\n\n    let newBoxes = update(boxes, {\n      $push: [\n        {\n          id: newId,\n          type: 'card',\n          isListItem: true,\n          top,\n          left,\n          title: `box #${newId}`,\n          blobUrl: undefined,\n        },\n      ],\n    });\n\n    newBoxes = update(newBoxes, {\n      [listIndex]: { cards: { $push: [newId] } },\n    });\n\n    updateBoxes(newBoxes);\n  };\n\n  const moveCard = (dragIndex: number, hoverIndex: number, cardId: number) => {\n    const listIndex = boxes.findIndex((box) => {\n      if (box.type === 'list' && box.cards.includes(cardId)) {\n        return true;\n      }\n\n      return false;\n    });\n\n    const newBoxes = update(boxes, {\n      [listIndex]: {\n        cards: {\n          $splice: [\n            [dragIndex, 1],\n            [hoverIndex, 0, cardId],\n          ],\n        },\n      },\n    });\n    \n    updateBoxes(newBoxes);\n  };\n\n  // event listener: handles playing next clip if available\n  const playNextClip = (e) => {\n    const currentId = e.currentTarget.id;\n    // finds the current index in listItems\n    const currentIndex = getCurrentIndex(currentId, listItems, id);\n    const nextIndex = currentIndex + 1;\n    const nextAudio = listItems[nextIndex] as any;\n\n    // if currentIndex exists and the next item exists as well, play the next track\n    if (currentIndex !== -1 && nextAudio && nextAudio.blobUrl) {\n      return playList(currentIndex + 1);\n    }\n\n    return setPlayList(false);\n  };\n\n  // event listener: if any item in list is paused, pause the whole list\n  const pauseList = (e) => {\n    if (\n      e.currentTarget.paused &&\n      e.currentTarget.duration !== e.currentTarget.currentTime\n    ) {\n      setPlayList(false);\n      e.currentTarget.removeEventListener('ended', playNextClip, {\n        once: true,\n      });\n      return;\n    }\n  };\n\n  // plays items in list\n  const playList = (n: number) => {\n    const listId = id;\n    const listItem = listItems[n];\n\n    if (listItem) {\n      const { id, blobUrl } = listItem;\n      const audioTag = document.getElementById(\n        getRecorderId(listId, id, blobUrl)\n      ) as HTMLAudioElement;\n\n      audioTag.currentTime = 0;\n\n      audioTag.addEventListener('ended', playNextClip, {\n        once: true,\n      });\n      audioTag.addEventListener('pause', pauseList, {\n        once: true,\n      });\n      audioTag.play();\n    }\n  };\n\n  return (\n    <StyledList ref={drop}>\n      <button disabled={playingList || fullDisable} onClick={addItem}>\n        Add list item\n      </button>\n      <button\n        disabled={fullDisable}\n        onClick={() => {\n          setPlayList(true);\n          playList(0);\n        }}\n      >\n        {playingList ? 'Stop' : 'Play'} list\n      </button>\n      <div className=\"cardWrapper\">\n        {listItems.length === 0 ? (\n          <div className=\"dropzone\">Drop box here</div>\n        ) : (\n          listItems.map((listItem, i) => (\n            <ListItem\n              key={`listKey:${Math.pow(new Date().getDate(), i)}`}\n              boxes={boxes}\n              left={left}\n              top={top}\n              listItemIndex={i}\n              id={listItem.id}\n              title={listItem.title}\n              blobUrl={listItem.blobUrl}\n              moveCard={moveCard}\n              updateBoxes={updateBoxes}\n              isListItem={listItem.isListItem}\n            >\n              <Box\n                box={listItem}\n                deleteBox={deleteBox}\n                fullDisable={fullDisable}\n                boxes={boxes}\n                updateBoxes={updateBoxes}\n              >\n                <Recorder\n                  playList={playingList}\n                  listId={id}\n                  cardId={listItem.id}\n                  onStop={onStop}\n                  blobUrl={listItem.blobUrl}\n                  setDisableAll={setDisableAll}\n                  fullDisable={fullDisable}\n                  socket={socket}\n                  title={listItem.title}\n                />\n              </Box>\n            </ListItem>\n          ))\n        )}\n      </div>\n    </StyledList>\n  );\n};\n\nexport default List;\n"]},"metadata":{},"sourceType":"module"}