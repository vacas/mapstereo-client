{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100vh;\\n  border: 1px solid black;\\n  position: relative;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useDrop } from 'react-dnd';\nimport { ItemTypes } from './ItemTypes';\nimport { useCurrentWidth, useCurrentHeight } from './helper';\nimport update from 'immutability-helper';\nvar StyledDroppableBackground = styled.div(_templateObject());\n\nvar DroppableBackground = function DroppableBackground(_ref) {\n  var updateBoxes = _ref.updateBoxes,\n      boxes = _ref.boxes,\n      setDisableAll = _ref.setDisableAll;\n  var width = useCurrentWidth();\n  var height = useCurrentHeight();\n  useEffect(function () {\n    for (var i = 0; i < boxes.length; i++) {\n      var _boxes$i = boxes[i],\n          left = _boxes$i.left,\n          top = _boxes$i.top,\n          id = _boxes$i.id;\n\n      if (left > width) {\n        moveBox(id, width - 50, top);\n      } else if (top > height) {\n        moveBox(id, left, height - 50);\n      }\n    }\n  }, [width, height]);\n\n  var _useDrop = useDrop({\n    accept: [ItemTypes.BOX, ItemTypes.CARD, ItemTypes.LIST],\n    drop: function drop(item, monitor) {\n      if (item.type === 'box' || item.type === 'list' || item.type === 'card' && !item.isListItem) {\n        var delta = monitor.getDifferenceFromInitialOffset();\n\n        if (delta) {\n          var left = Math.round(item.left + delta.x);\n          var top = Math.round(item.top + delta.y);\n\n          if (left < width - 50 && left > 0 && top > 0 && top < height - 50) {\n            moveBox(item.id, left, top);\n          }\n        }\n      }\n\n      if (item.type === 'card' && item.isListItem) {\n        var _delta = monitor.getClientOffset();\n\n        if (_delta && item.ref && item.ref.current) {\n          var boundingRect = item.ref.current.getBoundingClientRect();\n          var xPadding = 32;\n          var yPadding = 31;\n          var approxWidth = Math.floor(boundingRect.width);\n          var approxHeight = Math.floor(boundingRect.height); // top left corner minus half of the width of item\n\n          var _left = _delta.x - (approxWidth + xPadding) / 2; // top left corner minus half of the height of item\n\n\n          var _top = _delta.y - (approxHeight + yPadding) / 2;\n\n          var cardIndex = boxes.findIndex(function (box) {\n            return box.id === item.id;\n          });\n          var newBoxes = boxes;\n\n          if (cardIndex !== -1 && boxes[cardIndex].isListItem) {\n            var listIndex = boxes.findIndex(function (box) {\n              if (box.type === 'list' && box.cards.includes(item.id)) {\n                return true;\n              }\n\n              return false;\n            });\n            newBoxes = update(newBoxes, _defineProperty({}, listIndex, {\n              cards: {\n                $set: newBoxes[listIndex].cards.filter(function (cardId) {\n                  return cardId !== item.id;\n                })\n              }\n            }));\n          }\n\n          newBoxes = update(newBoxes, _defineProperty({}, cardIndex, {\n            $set: {\n              id: item.id,\n              type: item.type,\n              isListItem: false,\n              top: _top,\n              left: _left,\n              title: item.title,\n              blobUrl: item.blobUrl\n            }\n          }));\n          updateBoxes(newBoxes);\n        }\n\n        return {\n          type: 'droppable_background'\n        };\n      }\n\n      setDisableAll(false);\n    }\n  }),\n      _useDrop2 = _slicedToArray(_useDrop, 2),\n      drop = _useDrop2[1];\n\n  var moveBox = function moveBox(id, left, top) {\n    var updatedBoxes = update(boxes, {\n      $set: _toConsumableArray(boxes.map(function (box) {\n        if (box.id === id) {\n          return _objectSpread(_objectSpread({}, box), {}, {\n            left: left,\n            top: top\n          });\n        }\n\n        return box;\n      }))\n    });\n    updateBoxes(updatedBoxes);\n  };\n\n  return /*#__PURE__*/React.createElement(StyledDroppableBackground, {\n    ref: drop\n  });\n};\n\nexport default DroppableBackground;","map":{"version":3,"sources":["/Users/mfjvacas/Documents/Dev/GitHub/projects/mapstereo-client/components/DroppableBackground.tsx"],"names":["React","useEffect","styled","useDrop","ItemTypes","useCurrentWidth","useCurrentHeight","update","StyledDroppableBackground","div","DroppableBackground","updateBoxes","boxes","setDisableAll","width","height","i","length","left","top","id","moveBox","accept","BOX","CARD","LIST","drop","item","monitor","type","isListItem","delta","getDifferenceFromInitialOffset","Math","round","x","y","getClientOffset","ref","current","boundingRect","getBoundingClientRect","xPadding","yPadding","approxWidth","floor","approxHeight","cardIndex","findIndex","box","newBoxes","listIndex","cards","includes","$set","filter","cardId","title","blobUrl","updatedBoxes","map"],"mappings":"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","sourcesContent":["import React, { SetStateAction, Dispatch, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useDrop } from 'react-dnd';\nimport { ItemTypes } from './ItemTypes';\nimport maxBy from 'lodash/maxBy';\nimport { useCurrentWidth, useCurrentHeight } from './helper';\nimport BoxType from './types/box';\nimport update from 'immutability-helper';\n\nconst StyledDroppableBackground = styled.div`\n  width: 100%;\n  height: 100vh;\n  border: 1px solid black;\n  position: relative;\n`;\n\nconst DroppableBackground = ({\n  updateBoxes,\n  boxes,\n  setDisableAll,\n}: {\n  updateBoxes: (boxes: Array<BoxType>) => void;\n  boxes: Array<BoxType>;\n  setDisableAll: Dispatch<SetStateAction<boolean>>;\n}) => {\n  const width = useCurrentWidth();\n  const height = useCurrentHeight();\n\n  useEffect(() => {\n    for (let i = 0; i < boxes.length; i++) {\n      const { left, top, id } = boxes[i];\n      if (left > width) {\n        moveBox(id, width - 50, top);\n      } else if (top > height) {\n        moveBox(id, left, height - 50);\n      }\n    }\n  }, [width, height]);\n\n  const [, drop] = useDrop({\n    accept: [ItemTypes.BOX, ItemTypes.CARD, ItemTypes.LIST],\n    drop(item: any, monitor) {\n      if (item.type === 'box' || item.type === 'list' || (item.type === 'card' && !item.isListItem)) {\n        const delta = monitor.getDifferenceFromInitialOffset();\n\n        if (delta) {\n          const left = Math.round(item.left + delta.x);\n          const top = Math.round(item.top + delta.y);\n\n          if (left < width - 50 && left > 0 && top > 0 && top < height - 50) {\n            moveBox(item.id, left, top);\n          }\n        }\n      }\n\n      if (item.type === 'card' && item.isListItem) {\n        const delta = monitor.getClientOffset();\n\n        if (delta && item.ref && item.ref.current) {\n          const boundingRect = item.ref.current\n            .getBoundingClientRect();\n          const xPadding = 32;\n          const yPadding = 31;\n\n          const approxWidth = Math.floor(boundingRect.width);\n          const approxHeight = Math.floor(boundingRect.height);\n          // top left corner minus half of the width of item\n          const left = delta.x - (approxWidth + xPadding) / 2;\n          // top left corner minus half of the height of item\n          const top = delta.y - (approxHeight + yPadding) / 2;\n\n          const cardIndex = boxes.findIndex(box => box.id === item.id);\n          let newBoxes = boxes;\n\n          if (cardIndex !== -1 && boxes[cardIndex].isListItem) {\n            const listIndex = boxes.findIndex(box => {\n              if (box.type === 'list' && box.cards.includes(item.id)) {\n                return true;\n              }\n    \n              return false;\n            });\n\n            newBoxes = update(newBoxes, {\n              [listIndex]: {\n                cards: {\n                  $set: newBoxes[listIndex].cards.filter(cardId => cardId !== item.id)\n                }\n              }\n            })\n          }\n          \n          newBoxes = update(newBoxes, {\n            [cardIndex]: {\n              $set: {\n                id: item.id,\n                type: item.type,\n                isListItem: false,\n                top,\n                left,\n                title: item.title,\n                blobUrl: item.blobUrl,\n              }\n            }\n          });\n\n          updateBoxes(newBoxes);\n        }\n\n        return { type: 'droppable_background' };\n      }\n      setDisableAll(false);\n    },\n  });\n\n  const moveBox = (id, left, top) => {\n    const updatedBoxes = update(boxes, {\n      $set: [\n        ...boxes.map((box) => {\n          if (box.id === id) {\n            return { ...box, left, top };\n          }\n\n          return box;\n        }),\n      ],\n    });\n    updateBoxes(updatedBoxes);\n  };\n  return <StyledDroppableBackground ref={drop} />;\n};\n\nexport default DroppableBackground;\n"]},"metadata":{},"sourceType":"module"}