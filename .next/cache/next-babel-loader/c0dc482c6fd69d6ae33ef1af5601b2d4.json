{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/mfjvacas/Documents/Dev/GitHub/projects/mapstereo-client/components/List.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { useDrop } from 'react-dnd';\nimport styled from 'styled-components';\nimport ListItem from './ListItem';\nimport { ItemTypes } from './ItemTypes';\nimport maxBy from 'lodash/maxBy';\nimport { getRecorderId } from './helper';\nimport update from 'immutability-helper';\nimport Recorder from './Recorder';\nimport Box from './Box';\nconst StyledList = styled.div.withConfig({\n  displayName: \"List__StyledList\",\n  componentId: \"hnatn7-0\"\n})([\"& .cardWrapper{width:400px;z-index:3;margin:10px 0;}\"]);\n\nconst getCurrentIndex = (currentId, listItems, listId) => {\n  const currentIndex = listItems.findIndex(item => item && getRecorderId(listId, item.id, item.blobUrl) === currentId);\n  return currentIndex;\n};\n\nconst List = ({\n  updateBoxes,\n  boxes,\n  fullDisable,\n  setDisableAll,\n  playingList,\n  setPlayList,\n  listItems,\n  left,\n  top,\n  id,\n  onStop,\n  deleteBox,\n  socket\n}) => {\n  // if a box is dropped inside a list, box becomes into a list item and gets removed from droppable_background\n  const [, drop] = useDrop({\n    accept: [ItemTypes.CARD],\n    drop: item => {\n      if (item.type === 'card' && !item.isListItem) {\n        const listIndex = boxes.findIndex(box => box.id === id);\n\n        if (!boxes[listIndex].cards.includes(item.id)) {\n          const cardIndex = boxes.findIndex(box => box.id === item.id);\n          let newBoxes;\n          newBoxes = update(boxes, {\n            [listIndex]: {\n              cards: {\n                $push: [item.id]\n              }\n            }\n          });\n          newBoxes = update(newBoxes, {\n            [cardIndex]: {\n              $apply: box => _objectSpread(_objectSpread({}, box), {}, {\n                isListItem: true\n              })\n            }\n          });\n          updateBoxes(newBoxes);\n        }\n\n        setDisableAll(false);\n        return {\n          type: 'list'\n        };\n      }\n\n      return undefined;\n    }\n  }); // adds new list item\n\n  const addItem = () => {\n    const listIndex = boxes.findIndex(box => box.id === id);\n    const highestID = maxBy(boxes, 'id');\n    const newId = highestID.id + 1;\n    let newBoxes = update(boxes, {\n      $push: [{\n        id: newId,\n        type: 'card',\n        isListItem: true,\n        top,\n        left,\n        title: `box #${newId}`,\n        blobUrl: undefined\n      }]\n    });\n    newBoxes = update(newBoxes, {\n      [listIndex]: {\n        cards: {\n          $push: [newId]\n        }\n      }\n    });\n    updateBoxes(newBoxes);\n  };\n\n  const moveCard = (dragIndex, hoverIndex, cardId) => {\n    const listIndex = boxes.findIndex(box => {\n      if (box.type === 'list' && box.cards.includes(cardId)) {\n        return true;\n      }\n\n      return false;\n    });\n    const newBoxes = update(boxes, {\n      [listIndex]: {\n        cards: {\n          $splice: [[dragIndex, 1], [hoverIndex, 0, cardId]]\n        }\n      }\n    });\n    updateBoxes(newBoxes);\n  }; // event listener: handles playing next clip if available\n\n\n  const playNextClip = e => {\n    const currentId = e.currentTarget.id; // finds the current index in listItems\n\n    const currentIndex = getCurrentIndex(currentId, listItems, id);\n    const nextIndex = currentIndex + 1;\n    const nextAudio = listItems[nextIndex]; // if currentIndex exists and the next item exists as well, play the next track\n\n    if (currentIndex !== -1 && nextAudio && nextAudio.blobUrl) {\n      return playList(currentIndex + 1);\n    }\n\n    return setPlayList(false);\n  }; // event listener: if any item in list is paused, pause the whole list\n\n\n  const pauseList = e => {\n    if (e.currentTarget.paused && e.currentTarget.duration !== e.currentTarget.currentTime) {\n      setPlayList(false);\n      e.currentTarget.removeEventListener('ended', playNextClip, {\n        once: true\n      });\n      return;\n    }\n  }; // plays items in list\n\n\n  const playList = n => {\n    const listId = id;\n    const listItem = listItems[n];\n\n    if (listItem) {\n      const {\n        id,\n        blobUrl\n      } = listItem;\n      const audioTag = document.getElementById(getRecorderId(listId, id, blobUrl));\n      audioTag.currentTime = 0;\n      audioTag.addEventListener('ended', playNextClip, {\n        once: true\n      });\n      audioTag.addEventListener('pause', pauseList, {\n        once: true\n      });\n      audioTag.play();\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(StyledList, {\n    ref: drop,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 5\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    disabled: playingList || fullDisable,\n    onClick: addItem,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 7\n    },\n    __self: this\n  }, \"Add list item\"), /*#__PURE__*/React.createElement(\"button\", {\n    disabled: fullDisable,\n    onClick: () => {\n      setPlayList(true);\n      playList(0);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    },\n    __self: this\n  }, playingList ? 'Stop' : 'Play', \" list\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cardWrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    },\n    __self: this\n  }, listItems.length === 0 ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dropzone\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 11\n    },\n    __self: this\n  }, \"Drop box here\") : listItems.map((listItem, i) => /*#__PURE__*/React.createElement(ListItem, {\n    key: `listKey:${Math.pow(new Date().getDate(), i)}`,\n    boxes: boxes,\n    left: left,\n    top: top,\n    listItemIndex: i,\n    id: listItem.id,\n    title: listItem.title,\n    blobUrl: listItem.blobUrl,\n    moveCard: moveCard,\n    updateBoxes: updateBoxes,\n    isListItem: listItem.isListItem,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 13\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Box, {\n    box: listItem,\n    deleteBox: deleteBox,\n    fullDisable: fullDisable,\n    boxes: boxes,\n    updateBoxes: updateBoxes,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 15\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Recorder, {\n    playList: playingList,\n    listId: id,\n    cardId: listItem.id,\n    onStop: onStop,\n    blobUrl: listItem.blobUrl,\n    setDisableAll: setDisableAll,\n    fullDisable: fullDisable,\n    socket: socket,\n    title: listItem.title,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 17\n    },\n    __self: this\n  }))))));\n};\n\nexport default List;","map":{"version":3,"sources":["/Users/mfjvacas/Documents/Dev/GitHub/projects/mapstereo-client/components/List.tsx"],"names":["React","useDrop","styled","ListItem","ItemTypes","maxBy","getRecorderId","update","Recorder","Box","StyledList","div","getCurrentIndex","currentId","listItems","listId","currentIndex","findIndex","item","id","blobUrl","List","updateBoxes","boxes","fullDisable","setDisableAll","playingList","setPlayList","left","top","onStop","deleteBox","socket","drop","accept","CARD","type","isListItem","listIndex","box","cards","includes","cardIndex","newBoxes","$push","$apply","undefined","addItem","highestID","newId","title","moveCard","dragIndex","hoverIndex","cardId","$splice","playNextClip","e","currentTarget","nextIndex","nextAudio","playList","pauseList","paused","duration","currentTime","removeEventListener","once","n","listItem","audioTag","document","getElementById","addEventListener","play","length","map","i","Math","pow","Date","getDate"],"mappings":"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","sourcesContent":["import React, { Dispatch, SetStateAction } from 'react';\nimport { useDrop } from 'react-dnd';\nimport styled from 'styled-components';\nimport ListItem from './ListItem';\nimport { ItemTypes } from './ItemTypes';\nimport maxBy from 'lodash/maxBy';\nimport { getRecorderId } from './helper';\nimport BoxType from './types/box';\nimport update from 'immutability-helper';\nimport Recorder from './Recorder';\nimport Box from './Box';\n\nexport interface Props {\n  drop?: any;\n  deleteBox?: Function;\n  updateBoxes?: (boxes: Array<BoxType>) => void;\n  boxes?: Array<BoxType>;\n  setDisableAll?: Dispatch<SetStateAction<boolean>>;\n  fullDisable?: boolean;\n  playingList?: boolean;\n  setPlayList?: Dispatch<SetStateAction<boolean>>;\n  listItems?: Array<BoxType>;\n  left?: number;\n  top?: number;\n  id?: number;\n  onStop: (url: string, cardId: number) => void;\n  socket?: SocketIOClient.Socket;\n}\n\nconst StyledList = styled.div`\n  & .cardWrapper {\n    width: 400px;\n    z-index: 3;\n    margin: 10px 0;\n  }\n`;\n\nconst getCurrentIndex = (currentId, listItems, listId) => {\n  const currentIndex = listItems.findIndex(\n    (item) =>\n      item && getRecorderId(listId, item.id, item.blobUrl) === currentId\n  );\n\n  return currentIndex;\n};\n\nconst List = ({\n  updateBoxes,\n  boxes,\n  fullDisable,\n  setDisableAll,\n  playingList,\n  setPlayList,\n  listItems,\n  left,\n  top,\n  id,\n  onStop,\n  deleteBox,\n  socket,\n}: Props) => {\n  // if a box is dropped inside a list, box becomes into a list item and gets removed from droppable_background\n  const [, drop] = useDrop({\n    accept: [ItemTypes.CARD],\n    drop: (item: any) => {\n\n      if (item.type === 'card' && !item.isListItem) {\n        const listIndex = boxes.findIndex((box) => box.id === id);\n\n        if (!boxes[listIndex].cards.includes(item.id)) {\n          const cardIndex = boxes.findIndex((box) => box.id === item.id);\n          let newBoxes;\n          newBoxes = update(boxes, {\n            [listIndex]: {\n              cards: {\n                $push: [item.id],\n              },\n            },\n          });\n\n          newBoxes = update(newBoxes, {\n            [cardIndex]: {\n              $apply: (box) => ({\n                ...box,\n                isListItem: true,\n              }),\n            },\n          });\n\n          updateBoxes(newBoxes);\n        }\n\n        setDisableAll(false);\n\n        return { type: 'list' };\n      }\n\n      return undefined;\n    },\n  });\n\n  // adds new list item\n  const addItem = () => {\n    const listIndex = boxes.findIndex((box) => box.id === id);\n    const highestID = maxBy(boxes, 'id');\n    const newId = highestID.id + 1;\n\n    let newBoxes = update(boxes, {\n      $push: [\n        {\n          id: newId,\n          type: 'card',\n          isListItem: true,\n          top,\n          left,\n          title: `box #${newId}`,\n          blobUrl: undefined,\n        },\n      ],\n    });\n\n    newBoxes = update(newBoxes, {\n      [listIndex]: { cards: { $push: [newId] } },\n    });\n\n    updateBoxes(newBoxes);\n  };\n\n  const moveCard = (dragIndex: number, hoverIndex: number, cardId: number) => {\n    const listIndex = boxes.findIndex((box) => {\n      if (box.type === 'list' && box.cards.includes(cardId)) {\n        return true;\n      }\n\n      return false;\n    });\n\n    const newBoxes = update(boxes, {\n      [listIndex]: {\n        cards: {\n          $splice: [\n            [dragIndex, 1],\n            [hoverIndex, 0, cardId],\n          ],\n        },\n      },\n    });\n    \n    updateBoxes(newBoxes);\n  };\n\n  // event listener: handles playing next clip if available\n  const playNextClip = (e) => {\n    const currentId = e.currentTarget.id;\n    // finds the current index in listItems\n    const currentIndex = getCurrentIndex(currentId, listItems, id);\n    const nextIndex = currentIndex + 1;\n    const nextAudio = listItems[nextIndex] as any;\n\n    // if currentIndex exists and the next item exists as well, play the next track\n    if (currentIndex !== -1 && nextAudio && nextAudio.blobUrl) {\n      return playList(currentIndex + 1);\n    }\n\n    return setPlayList(false);\n  };\n\n  // event listener: if any item in list is paused, pause the whole list\n  const pauseList = (e) => {\n    if (\n      e.currentTarget.paused &&\n      e.currentTarget.duration !== e.currentTarget.currentTime\n    ) {\n      setPlayList(false);\n      e.currentTarget.removeEventListener('ended', playNextClip, {\n        once: true,\n      });\n      return;\n    }\n  };\n\n  // plays items in list\n  const playList = (n: number) => {\n    const listId = id;\n    const listItem = listItems[n];\n\n    if (listItem) {\n      const { id, blobUrl } = listItem;\n      const audioTag = document.getElementById(\n        getRecorderId(listId, id, blobUrl)\n      ) as HTMLAudioElement;\n\n      audioTag.currentTime = 0;\n\n      audioTag.addEventListener('ended', playNextClip, {\n        once: true,\n      });\n      audioTag.addEventListener('pause', pauseList, {\n        once: true,\n      });\n      audioTag.play();\n    }\n  };\n\n  return (\n    <StyledList ref={drop}>\n      <button disabled={playingList || fullDisable} onClick={addItem}>\n        Add list item\n      </button>\n      <button\n        disabled={fullDisable}\n        onClick={() => {\n          setPlayList(true);\n          playList(0);\n        }}\n      >\n        {playingList ? 'Stop' : 'Play'} list\n      </button>\n      <div className=\"cardWrapper\">\n        {listItems.length === 0 ? (\n          <div className=\"dropzone\">Drop box here</div>\n        ) : (\n          listItems.map((listItem, i) => (\n            <ListItem\n              key={`listKey:${Math.pow(new Date().getDate(), i)}`}\n              boxes={boxes}\n              left={left}\n              top={top}\n              listItemIndex={i}\n              id={listItem.id}\n              title={listItem.title}\n              blobUrl={listItem.blobUrl}\n              moveCard={moveCard}\n              updateBoxes={updateBoxes}\n              isListItem={listItem.isListItem}\n            >\n              <Box\n                box={listItem}\n                deleteBox={deleteBox}\n                fullDisable={fullDisable}\n                boxes={boxes}\n                updateBoxes={updateBoxes}\n              >\n                <Recorder\n                  playList={playingList}\n                  listId={id}\n                  cardId={listItem.id}\n                  onStop={onStop}\n                  blobUrl={listItem.blobUrl}\n                  setDisableAll={setDisableAll}\n                  fullDisable={fullDisable}\n                  socket={socket}\n                  title={listItem.title}\n                />\n              </Box>\n            </ListItem>\n          ))\n        )}\n      </div>\n    </StyledList>\n  );\n};\n\nexport default List;\n"]},"metadata":{},"sourceType":"module"}